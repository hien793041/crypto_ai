2024-08-03T13:58:28.5550727+07:00	FAIL	[Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware]	[UnhandledException]	An unhandled exception has occurred while executing the request.Npgsql.PostgresException (0x80004005): 42712: table name "s" specified more than once
   at Npgsql.Internal.NpgsqlConnector.<ReadMessage>g__ReadMessageLong|211_0(NpgsqlConnector connector, Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at Npgsql.NpgsqlDataReader.<ReadMessage>g__ReadMessageSequential|44_0(NpgsqlConnector connector, Boolean async)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult()
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(CommandBehavior behavior, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteScalar(Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteScalar()
   at ONE_API.Controllers.ONEController.GetDataFromPostgreSQL(Object msg) in D:\Projects\ONE\ONE-API\Controllers\ONEController.cs:line 61
   at lambda_method2(Closure , Object , Object[] )
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeNextActionFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
  Exception data:
    Severity: ERROR
    SqlState: 42712
    MessageText: table name "s" specified more than once
    Where: SQL statement "SELECT json_agg(row)                         FROM (
                        SELECT srp."Id", srp."StockId", s."Code", srp."DateCreated", srp."Status", srp."BuyPrice", srp."SoldPrice"
								, srp."Profit", srp."TargetPrice", srp."UpSide", srp."StopLoss", srp."DownSide"
								, srp."RRR", srp."Valuation", srp."ReasonableLevel", srp."LevelOfFluctuation"
								, srp."FinancialHealth", srp."HoldingPeriod", srp."IntendTime", srp."UserIdCreated"
								, srp."DateBought"
                        		, row_number() OVER (ORDER BY srp."DateCreated" DESC) AS "Row"
                                , count(*) OVER() AS "TotalRow"
	                    FROM public."Stock_RecommendationsPortfolio" srp
							INNER JOIN public."Stock" s ON srp."StockId" = s."Id"
							INNER JOIN public."Status" s ON s."Type" = 2 AND srp."Status" = s."Value"
							INNER JOIN public."Resources" r ON s."ResourceName" = r."Name" AND r."LanguageId" = LanguageId
							INNER JOIN public."Users" ucreated on srp."UserIdCreated" = ucreated."Id"
                        WHERE srp."UserIdCreated" = userid AND (status = -1 OR srp."Status" = status)
                        ORDER BY srp."DateCreated" DESC
                        OFFSET (page - 1)*pagesize LIMIT pagesize
                ) row"
Hàm PL/pgSQL stock_recommendationsportfolio_getlist(json) dòng 15 tại Câu lệnh SQL
    File: parse_relation.c
    Line: 466
    Routine: checkNameSpaceConflicts

